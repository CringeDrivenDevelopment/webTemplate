#!/bin/sh

echo "ğŸ¨
 Generating code..."

if ! task sqlc; then
    echo "âŒ
 SQLC failed."
    exit 1
fi

if ! task mockery:gen; then
    echo "âŒ
 Mockery failed."
    exit 1
fi

if ! task swag; then
    echo "âŒ
 Swag failed."
    exit 1
fi

echo "ğŸ¨
 Formatting code..."

if ! task format; then
    echo "âŒ
 Formatting failed."
    exit 1
fi

echo "ğŸ”
 Running linters..."

if ! task lint; then
    echo "âŒ
 Linting failed. Please fix the issues before committing."
    exit 1
fi

echo "ğŸ§ª
 Running tests..."

if ! task test; then
    echo "âŒ
 Tests failed. Please fix the issues before committing."
    exit 1
fi

if ! cd tests/e2e && ./run.sh && cd ../..; then
    echo "âŒ
 E2E failed. Please fix the issues before committing."
    exit 1
fi

echo "âœ…
 Format, linters, and tests passed"
exit 0
